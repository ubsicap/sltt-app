console.log('afterSign hook triggered')

require('dotenv').config()

const { notarize } = require('@electron/notarize')

exports.default = async function notarizing(context) {
  const { electronPlatformName, appOutDir } = context
  if (electronPlatformName !== 'darwin') {
    return
  }

  console.log('notarizing...')

  const appName = context.packager.appInfo.productFilename

  // Get appleId and appleIdPassword from environment variables.
  // These values are in the .env file.
  // appleId: email address you use to login to App Store Connect
  // appleIdPassword: app-specific password generated by appleid.apple.com
  const { appleId, appleIdPassword, teamId } = process.env

  if (!appleId || !appleIdPassword || !teamId) {
    console.error('Missing Apple ID or Apple ID password or Team ID')
    return
  }

  return await notarize({
    appBundleId: 'net.sltt-bible.app',
    appPath: `${appOutDir}/${appName}.app`,
    appleId,
    appleIdPassword,
    tool: 'notarytool',
    teamId,
  })
}
